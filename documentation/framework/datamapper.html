<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" href="../../media/images/favicon.ico" />

        <title>DataMapper | Windwalker Joomla RAD</title>

        <!-- Uikit core CSS -->
        <link href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/css/uikit.min.css" rel="stylesheet">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/rainbow.min.css"/>

        <!-- Custom styles for this template -->
        <link href="../../media/css/main.css" rel="stylesheet">

        <meta name="description" content="">
        <meta name="generator" content="The Time Machine">

        <meta property="og:title" content="DataMapper | Windwalker Joomla RAD">
        <meta property="og:site_name" content="Windwalker Joomla RAD">

        
        <!-- Bootstrap core JavaScript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="../../media/js/jquery.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/js/uikit.min.js"></script>
        <script src="../../media/js/highlight.pack.js"></script>
        <script>
        	// Redirect
        	if (location.pathname.indexOf('windwalker-rad-doc') == 1)
        	{
        		var paths = location.pathname.split('/');

        		paths.shift();
        		paths.shift();

        		paths = paths.join('/');

        		location.replace('http://rad.windwalker.io/' + paths);
        	} 

            $(document).ready(function() {

                $('.article-content pre code, #compare pre').each(function(i, block) {
                    hljs.highlightBlock(block);
                });
            });
        </script>

            <script src="../../media/js/doc.js"></script>
    </head>
    <body class="">
    <nav id="header" class="uk-navbar uk-navbar-attached">
        <div class="uk-container uk-container-center">

            <a id="big-logo" class="uk-navbar-brand uk-hidden-small" href="../../">
                <img class="uk-margin uk-margin-remove" src="../../media/images/logo/windwalker-logo.png" title="Asukademy" alt="Asukademy">
            </a>

            <a href="#" class="uk-navbar-toggle uk-visible-small" data-uk-toggle="{target:'#mainmenu', cls: 'uk-hidden-small'}"></a>

            <a id="small-logo" class="uk-navbar-brand uk-navbar-center uk-visible-small" href="../../">
                <img class="uk-margin uk-margin-remove" style="max-width: 95%;" src="../../media/images/logo/windwalker-logo.png" title="Asukademy" alt="Asukademy">
            </a>

            <ul id="mainmenu" class="uk-navbar-nav uk-float-right uk-hidden-small">
                <li class="">
                    <a href="../../about/">
                        <span class="menu-item-title">About</span>
                    </a>
                </li>

                <li class="uk-active">
                    <a href="../../documentation/basic/getting-started.html">
                        <span class="menu-item-title">Documentation</span>
                    </a>
                </li>

                <li class="">
                    <a href="https://github.com/ventoviro/windwalker-joomla-rad" target="_blank">
                        <span class="menu-item-title">GitHub</span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>

    <section id="banner">
        <div class="banner-inner">
                <div class="uk-container uk-container-center banner-inner-title">
        <h1>DataMapper</h1>
    </div>
        </div>
    </section>

    <div id="main-body">
            <div class="uk-container uk-container-center">
        <div class="uk-grid">
                <div class="uk-width-medium-1-4 uk-container-center">
        <ul class="uk-nav uk-nav-side side-menu side-bar" data-uk-nav="">
        <li class="uk-nav-header">Basic</li>

                    <li class="">
                <a href="../../documentation/basic/getting-started.html">Getting Started</a>
            </li>
                    <li class="">
                <a href="../../documentation/basic/create-component.html">Create Component</a>
            </li>
        
    <li class="uk-nav-divider"></li>
       <li class="uk-nav-header">Admin</li>

                    <li class="">
                <a href="../../documentation/admin/controller.html">Controller</a>
            </li>
                    <li class="">
                <a href="../../documentation/admin/model.html">Model</a>
            </li>
                    <li class="">
                <a href="../../documentation/admin/model-list.html">ModelList</a>
            </li>
                    <li class="">
                <a href="../../documentation/admin/batch.html">Batch</a>
            </li>
                    <li class="">
                <a href="../../documentation/admin/model-admin.html">ModelAdmin</a>
            </li>
                    <li class="">
                <a href="../../documentation/admin/formfield.html">FormField</a>
            </li>
        
    <li class="uk-nav-divider"></li>
       <li class="uk-nav-header">General</li>

                    <li class="">
                <a href="../../documentation/general/asset.html">Css &amp; JS Management</a>
            </li>
                    <li class="">
                <a href="../../documentation/general/config.html">Config</a>
            </li>
                    <li class="">
                <a href="../../documentation/general/event-listener.html">Event Listener</a>
            </li>
                    <li class="">
                <a href="../../documentation/general/html.html">HTML Builder</a>
            </li>
                    <li class="">
                <a href="../../documentation/general/thumb.html">Thumb</a>
            </li>
        
    <li class="uk-nav-divider"></li>
       <li class="uk-nav-header">Helpers</li>

                    <li class="">
                <a href="../../documentation/helpers/profiler.html">ProfilerHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/modal.html">ModalHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/jcontent.html">JContentHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/extension.html">ExtensionHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/uri.html">UriHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/curl.html">CurlHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/date.html">DateHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/html.html">HtmlHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/language.html">LanguageHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/xml.html">XmlHelper</a>
            </li>
                    <li class="">
                <a href="../../documentation/helpers/path.html">PathHelper</a>
            </li>
        
    <li class="uk-nav-divider"></li>
       <li class="uk-nav-header">Framework Packages</li>

                    <li class="">
                <a href="../../documentation/framework/data.html">Data</a>
            </li>
                    <li class="uk-active">
                <a href="../../documentation/framework/datamapper.html">DataMapper</a>
            </li>
                    <li class="">
                <a href="../../documentation/framework/compare.html">Compare</a>
            </li>
                    <li class="">
                <a href="../../documentation/framework/middleware.html">Middleware</a>
            </li>
        
    <li class="uk-nav-divider"></li>
   </ul>    </div>

            <div class="uk-width-medium-3-4 uk-container-center">
                <article class="article-content">
                    <h1>Getting Started</h1>

<h2>Prepare Database object</h2>

<pre><code class="php">use Windwalker\Database\DatabaseFactory;

// Make the database driver.
$db = DatabaseFactory::getDbo(
    array(
        'driver'   =&gt; 'mysql',
        'host'     =&gt; 'localhost',
        'user'     =&gt; 'root',
        'password' =&gt; 'xxxx',
        'database' =&gt; 'mydb',
        'prefix'   =&gt; 'prefix_'
    )
);
</code></pre>

<p>You can get Database later by Factory:</p>

<pre><code class="php">$db = DatabaseFactory::getDbo();
</code></pre>

<p>See Joomla Database: https://github.com/joomla-framework/database</p>

<h1>Create a DataMapper</h1>

<pre><code class="php">use Windwalker\DataMapper\DataMapper;

$fooMapper = new DataMapper('#__foo');

$fooSet = $fooMapper-&gt;find(array('id' =&gt; 1));
</code></pre>

<h1>Find Records</h1>

<p>Find method will fetch rows from table, and return <code>DataSet</code> class.</p>

<h2>find()</h2>

<p>Get id = 1 record</p>

<pre><code class="php">$fooSet = $fooMapper-&gt;find(array('id' =&gt; 1));
</code></pre>

<p>Fetch published = 1, and sort by <code>date</code></p>

<pre><code class="php">$fooSet = $fooMapper-&gt;find(array('published' =&gt; 1), 'date');
</code></pre>

<p>Fetch published = 1, language = en-US, sort by <code>date</code> DESC and start with <code>30</code>, limit <code>10</code>.</p>

<pre><code class="php">$fooSet = $fooMapper-&gt;find(array('published' =&gt; 1, 'language' =&gt; 'en-US'), 'date DESC', 30, 10);
</code></pre>

<p>Using array, will be <code>IN</code> condition:</p>

<pre><code class="php">$fooSet = $fooMapper-&gt;find(array('id' =&gt; array(1,2,3))); // WHERE id IN (1,2,3)
</code></pre>

<h2>findOne()</h2>

<p>Just return one row.</p>

<pre><code class="php">$foo = $dooMapper-&gt;findOne(array('published' =&gt; 1), 'date');
</code></pre>

<h2>findAll()</h2>

<p>Equal to <code>find(array(), $order, $start, $limit)</code>.</p>

<h1>Create Records</h1>

<p>Using DataSet to wrap every data, then send this object to create() method, these data will insert to table.</p>

<h2>create()</h2>

<pre><code class="php">use Windwalker\Data\Data;
use Windwalker\Data\DataSet;

$data1 = new Data;
$data1-&gt;title = 'Foo';
$data1-&gt;auhor = 'Magneto';

$data2 = new Data(
    array(
        'title' =&gt; 'Bar',
        'author' =&gt; 'Wolverine'
    )
);

$dataset = new DataSet(array($data1, $data2));

$return = $fooMapper-&gt;create($dataset);
</code></pre>

<p>The return value will be whole dataset and add inserted ids.</p>

<pre><code>Windwalker\Data\DataSet Object
(
    [storage:ArrayObject:private] =&gt; Array
        (
            [0] =&gt; Windwalker\Data\Data Object
                (
                    [title] =&gt; Foo
                    [auhor] =&gt; Magneto
                    [id] =&gt; 39
                )

            [1] =&gt; Windwalker\Data\Data Object
                (
                    [title] =&gt; Bar
                    [auhor] =&gt; Wolverine
                    [id] =&gt; 40
                )
        )
)
</code></pre>

<h2>createOne()</h2>

<p>Only insert one row, do not need DataSet.</p>

<pre><code class="php">$data = new Data;
$data-&gt;title = 'Foo';
$data-&gt;auhor = 'Magneto';

$fooMapper-&gt;createOne($data);
</code></pre>

<h1>Update Records</h1>

<p>Update methods help us update rows in table.</p>

<h2>update()</h2>

<pre><code class="php">use Windwalker\Data\Data;
use Windwalker\Data\DataSet;

$data1 = new Data;
$data1-&gt;id = 1;
$data1-&gt;title = 'Foo';

$data2 = new Data(
    array(
        'id' =&gt; 2,
        'title' =&gt; 'Bar'
    )
);

$dataset = new DataSet(array($data1, $data2));

$fooMapper-&gt;update($dataset);
</code></pre>

<h2>updateOne()</h2>

<p>Just update one row.</p>

<pre><code class="php">$data = new Data;
$data-&gt;id = 1;
$data-&gt;title = 'Foo';

$fooMapper-&gt;updateOne($data);
</code></pre>

<h2>updateAll()</h2>

<p>UpdateAll is different from update method, we just send one data object, but using conditions as where
to update every row match these conditions. We don't need primary key for updateAll().</p>

<pre><code class="php">$data = new Data;
$data-&gt;published = 0;

$fooMapper-&gt;updateAll($data, array('author' =&gt; 'Mystique'));
</code></pre>

<h1>Delete</h1>

<p>Delete rows by conditions.</p>

<h2>delete()</h2>

<pre><code class="php">$boolean = $fooMapper-&gt;delete(array('author' =&gt; 'Jean Grey'));
</code></pre>

<h1>Join Tables</h1>

<p>Using <code>RelationDataMapper</code> to join tables.</p>

<pre><code class="php">$fooMapper = new RelationDataMapper('foo', '#__foo');

$fooMapper-&gt;addTable('author', '#__users', 'foo.user_id = author.id', 'LEFT')
    -&gt;addTable('category', '#__categories', array('category.lft &gt;= foo.lft', 'category.rgt &lt;= foo.rgt'), 'INNER');

// Don't forget add alias on where conditions.
$dataset = $fooMapper-&gt;find(array('foo.id' =&gt; 5));
</code></pre>

<p>The Join query will be:</p>

<pre><code class="sql">FROM #__foo AS foo
    LEFT JOIN #__users AS author ON foo.user_id = author.id
    INNER JOIN #__categories AS category ON category.lft &gt;= foo.lft AND category.rgt &lt;= foo.rgt
</code></pre>

<h2>Using OR Condition</h2>

<pre><code class="php">$fooMapper-&gt;addTable(
    'category',
    '#__categories',
    'category.lft &gt;= foo.lft OR category.rgt &lt;= foo.rgt',
    'LEFT'
);
</code></pre>

<h1>Compare objects</h1>

<p>Using Compare objects help us set some where conditions which hard to use array to defind.</p>

<pre><code class="php">$fooSet = $fooMapper-&gt;find(
    array(
        new GteCompare('id', 5),
        new NeqCompare('name', 'bar')
        new LtCompare('published', 1),
        new NinCompare('catid', array(1,2,3,4,5))
    )
);
</code></pre>

<p>This will generate where conditions like below:</p>

<pre><code class="sql">WHERE `id` &gt;= '5'
    AND `name` != 'bar'
    AND `published` &lt; '1'
    AND `catid` NOT IN (1,2,3,4,5)
</code></pre>

<h2>Abailable compares:</h2>

<ul>
<li>EqCompare  : Equal <code>=</code></li>
<li>NeqCompare : Not Equal <code>!=</code></li>
<li>GtCompare  : Greater than <code>&gt;</code></li>
<li>GteCompare : Greate than or Equal <code>&gt;=</code></li>
<li>LtCompare  : Less than <code>&lt;</code></li>
<li>LteCompare : Less than or Equal <code>&lt;=</code></li>
<li>InCompare  : In <code>IN</code></li>
<li>NinCompare : Not In <code>NOT IN</code></li>
</ul>

<h2>Custom Compare</h2>

<pre><code class="php">echo (string) new Compare('title', '%flower%', 'LIKE');
</code></pre>

<p>Will be</p>

<pre><code class="sql">`title` LIKE `%flower%`
</code></pre>

<p>See: https://github.com/ventoviro/windwalker-compare</p>

<h1>Using Data and DataSet</h1>

<p>See: https://github.com/ventoviro/windwalker-data</p>

                        <hr />

    <p class="uk-text-center">
        Found a typo? Help us <a target="_blank" href="https://github.com/ventoviro/windwalker-rad-doc/tree/master/.vaseman/entries">improve</a> this document.
    </p>
    <blockquote class="uk-text-center">
        This document is for Windwalker Joomla RAD, if you are finding Windwalker PHP framework, please see: <a target="_blank" href="http://windwalker.io">Windwalker Framework</a>
    </blockquote>
                </article>
            </div>
        </div>
    </div>
    </div>

    <footer id="footer">
        <div class="uk-container uk-container-center uk-text-center">

            <div class="footer-logo">
                <a href="#" data-uk-smooth-scroll>
                    <img src="../../media/images/logo/windwalker-logo.png" width="150" alt="Footer LOGO">
                </a>
            </div>

            <p class="uk-text-center social-buttons">
                <a target="_blank" class="uk-icon-button uk-icon-facebook" href="javascript: void(0);"></a>

                <a target="_blank" class="uk-icon-button uk-icon-github" href="https://github.com/ventoviro/windwalker-joomla-rad"></a>

                <a class="uk-icon-button uk-icon-envelope-o" href="mailto:asika32764@gmail.com"></a>
            </p>

            <p>
                Copyright &copy; 2016 Windwalker. All Rights Reserved.
            </p>
            <p class="back">
                <a href="#" data-uk-smooth-scroll><span class="uk-icon-chevron-up"></span> Back to Top</a>
            </p>
        </div>
    </footer>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-48372917-6', 'auto');
        ga('send', 'pageview');

    </script>

    </body>
</html>
